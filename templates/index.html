{% extends "base/base.html" %}
{% load static %}
{% block title %}
    轨道交通智慧客流分析预测平台
{% endblock title %}

{% block breadcrumb %}
<li><a href="{% url 'transit:index' %}"><i class="fa fa-dashboard"></i>
  {% if meta %}{{meta.logo}}{% else %}仪表盘{% endif %}
</a></li>
<li class="active">仪表盘</li>
{% endblock breadcrumb %}


{% block main-content %}
<div class="box">
    <div class="box-header with-border">
        <h3 class="box-title">{{ date }}整体客流波动分析</h3>
        <div class="box-tools pull-right">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
          </button>
          <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
        </div>
    </div>

    <div class="box-body">
        <div class="row">

            <div class="col-md-7 col-xs-12">
                <div id="eachSta"style="min-width:320px;height: 400px"></div>
            </div>

            <div class="clearfix visible-sm-block"></div>

            <div class="col-md-5 col-xs-12">
                <div id="age_struct"style="min-height: 320px;height: 400px"></div>
            </div>
            <div class="col-md-12 col-xs-12">
                <div id="peak"style="min-width:320px;height: 400px"></div>
            </div>

        </div>
    </div>
</div>
{% endblock main-content %}

{% block extra-js %}
    <script type="text/javascript">
        var myChart =echarts.init(document.getElementById('eachSta'));
        var date = new Date();
        var year = date.getFullYear()-1;
        var month = (date.getMonth()+1).toString().padStart(2,'0');
        var day = date.getDate().toString().padStart(2,'0');
        $.ajax({
            url:"/api/echarts/data/eachSta/2020/01/01",
            type:"get",
            dataType:"json",
            success:function (data){
                   myChart.setOption(option = {
                        title: {
                            text: year+"-"+month+"-"+day+'各站点的客流压力',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['进站客流', '出站客流'],
                            left: "right"
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: data.label
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: '进站客流',
                                type: 'line',
                                stack: '总量',
                                data: data.inNum
                            },
                            {
                                name: '出站客流',
                                type: 'line',
                                stack: '总量',
                                data: data.outNum
                            }
                        ]
                    }
                );
            }
        });
    </script>
   <script type="text/javascript">
        var echart_age_struct = echarts.init(document.getElementById('age_struct'));
        $.ajax({
           url:"/api/echarts/data/agestruct",
            type:"get",
            dataType: "json",
            success:function (data) {
                echart_age_struct.setOption(
                    option = {
                        title: {
                            text: '乘客年龄结构',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b} : {c} ({d}%)'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'right',
                            data: data.name
                        },
                        series: [
                            {
                                name: '年龄区间',
                                type: 'pie',
                                radius: '55%',
                                center: ['50%', '60%'],
                                data: data.data,
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    }

                );
            }
        });
   </script>
    <script type="text/javascript">
        var mychart = echarts.init(document.getElementById("peak"));
        var date = new Date();
        var year = date.getFullYear()-1;
        var month = (date.getMonth()+1).toString().padStart(2,'0');
        var day = date.getDate().toString().padStart(2,'0');
        var hour = date.getHours().toString().padStart(2,'0');
        $.ajax({
            url: "/api/echarts/data/peak/"+year+"/"+month+"/"+day+"/"+hour,
            type: "GET",
            dataType: "json",
            success: function (data){
                mychart.setOption(
                    option = {
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                crossStyle: {
                                    color: '#999'
                                }
                            }
                        },
                        legend: {
                            data: ['进站情况', '出站情况']
                        },
                        xAxis: [
                            {
                                type: 'category',
                                data: data.station,
                                axisPointer: {
                                    type: 'shadow'
                                }
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                name: '进站情况',
                                min: 0,
                                max: 250,
                                interval: 50,
                                axisLabel: {
                                    formatter: '{value} 人'
                                }
                            },
                            {
                                type: 'value',
                                name: '出站情况',
                                min: 0,
                                max: 25,
                                interval: 5,
                                axisLabel: {
                                    formatter: '{value} 人'
                                }
                            }
                        ],
                        series: [
                            {
                                name: '进站情况',
                                type: 'bar',
                                data: data.in_pressure
                            },
                            {
                                name: '出站情况',
                                type: 'bar',
                                data: data.out_pressure
                            }
                        ]
                    }
                );
            }
        });
    </script>
{% endblock extra-js %}